<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <title>TP2</title>
</head>
<body>
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <nav class="navbar navbar-expand-lg navbar-light bg-light">
                    <div class="container-fluid">
                      <a class="navbar-brand" href="#">GESTION DES ETUDIANTS</a>
                      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                      </button>
                      <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                          <li class="nav-item">
                            <a class="nav-link active" aria-current="page" href="index.html">ETUDIANTS</a>
                          </li>
                          <li class="nav-item">
                            <a class="nav-link active" aria-current="page" href="departements.html">DEPARTEMENTS</a>
                          </li>
                          <li class="nav-item">
                            <a class="nav-link active" aria-current="page" href="matieres.html">MATIERES</a>
                          </li>
                          <li class="nav-item">
                            <a class="nav-link active" aria-current="page" href="notes.html">NOTES</a>
                          </li>
                        </ul>
                      </div>
                    </div>
                  </nav>
            </div>
        </div>
        <div class="row">
          <div class="col-md-6">
              <h4>Liste des departements</h4>
              <table class="table table-striped">
                  <thead>
                    <th>N <sup>o</sup></th>
                    <th>Nom</th>
                    <th>Actions</th>
                  </thead>
                  <tbody id="listeDepartementDisplay">
                    
                  </tbody>
              </table>
          </div>
          <div class="col-md-6">
              <div class="form">
                <div class="form-group">
                  <label for="#">Nom</label>
                  <input type="text" class="form-control" name="nom" id="nom">
                </div>
                <hr>
                <div class="form-group">
                  <button type="submit" class="btn btn-primary" id="enregistrerDepartement">
                    Enregistrer
                  </button>
                </div>
              </div>
          </div>
        </div>
    </div> 
    <script>
      document.addEventListener("DOMContentLoaded", function(){
       
          let enregistrerDepartement = document.querySelector("#enregistrerDepartement");
          let listeDepartementDisplay = document.querySelector("#listeDepartementDisplay");
          let listeDesDepartementsArray    = (localStorage.getItem("listeDepartements")) ? JSON.parse(localStorage.getItem("listeDepartements")) : [] ;

          enregistrerDepartement.addEventListener("click", function(){
            let nom = document.querySelector("#nom");
            saveToDB(nom.value);
          });

          function saveToDB(value){
              if(localStorage.getItem("listeDepartements")){
                listeDesDepartementsArray = JSON.parse(localStorage.getItem("listeDepartements"));
                listeDesDepartementsArray.push(value)
                localStorage.setItem("listeDepartements", JSON.stringify(listeDesDepartementsArray)); 

              }else{
                listeDesDepartementsArray.push(value);
                localStorage.setItem("listeDepartements", JSON.stringify(listeDesDepartementsArray)); 
              }

              displayContent();
            
          }

          function displayContent(){
            let content = JSON.parse(localStorage.getItem("listeDepartements"));
            listeDepartementDisplay.innerHTML = "";
           
            if(content.length > 0){
              content.forEach((element, index) => {
                let tr = document.createElement("tr");
                tr.innerHTML = `
                                <td>${ (index + 1) }</td>
                                <td>${element}</td> 
                                <td>
                                  <button class="btn btn-primary">Modifier</button>
                                  <button class="btn btn-danger remove" value="${index}">Supprimer</button>
                                </td>
                              `;
                listeDepartementDisplay.appendChild(tr);
              });
              remove();
            }else{
              let tr = document.createElement("tr");
              tr.innerHTML = `<td colspan="3" class="text-center">La liste est vide</td>`;
              listeDepartementDisplay.appendChild(tr);
            }
          }

          function remove(){
            let btnRemove = document.querySelectorAll(".remove");
          

            btnRemove.forEach((element)=>{
              element.addEventListener("click", function(){

                let btnIndex = this.getAttribute("value");
                let index = listeDesDepartementsArray.findIndex((item, index)=> index == btnIndex);
                listeDesDepartementsArray.splice(index, 1);
                localStorage.setItem("listeDepartements", JSON.stringify(listeDesDepartementsArray));
                displayContent();
              });

            });
          }

          

          (function(){
            displayContent();
          })();
      });
    </script>   
</body>
</html>